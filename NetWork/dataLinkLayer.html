<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>数据链路层 | Cyy&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="我的博客">
    
    <link rel="preload" href="/assets/css/0.styles.f3d49e5c.css" as="style"><link rel="preload" href="/assets/js/app.af7ffc51.js" as="script"><link rel="preload" href="/assets/js/2.d1a5c91e.js" as="script"><link rel="preload" href="/assets/js/1.8e8fa9b9.js" as="script"><link rel="preload" href="/assets/js/62.ae031adb.js" as="script"><link rel="prefetch" href="/assets/js/10.fc8ce149.js"><link rel="prefetch" href="/assets/js/11.12f2f6ed.js"><link rel="prefetch" href="/assets/js/12.030ed1f1.js"><link rel="prefetch" href="/assets/js/13.0dcc940a.js"><link rel="prefetch" href="/assets/js/14.a219b5b9.js"><link rel="prefetch" href="/assets/js/15.552b7e3f.js"><link rel="prefetch" href="/assets/js/16.8a79d68c.js"><link rel="prefetch" href="/assets/js/17.03d26256.js"><link rel="prefetch" href="/assets/js/18.96b348ec.js"><link rel="prefetch" href="/assets/js/19.a87f1095.js"><link rel="prefetch" href="/assets/js/20.059813bd.js"><link rel="prefetch" href="/assets/js/21.78e06c9a.js"><link rel="prefetch" href="/assets/js/22.6c408340.js"><link rel="prefetch" href="/assets/js/23.113c6709.js"><link rel="prefetch" href="/assets/js/24.fa651541.js"><link rel="prefetch" href="/assets/js/25.4b3a8146.js"><link rel="prefetch" href="/assets/js/26.0755b97a.js"><link rel="prefetch" href="/assets/js/27.fea4d251.js"><link rel="prefetch" href="/assets/js/28.9ef8faa1.js"><link rel="prefetch" href="/assets/js/29.3d65f365.js"><link rel="prefetch" href="/assets/js/3.634769dd.js"><link rel="prefetch" href="/assets/js/30.3671bda7.js"><link rel="prefetch" href="/assets/js/31.bdd25f10.js"><link rel="prefetch" href="/assets/js/32.d6867bf2.js"><link rel="prefetch" href="/assets/js/33.28d5d6a3.js"><link rel="prefetch" href="/assets/js/34.4448dff5.js"><link rel="prefetch" href="/assets/js/35.dabbecf7.js"><link rel="prefetch" href="/assets/js/36.6a9c6f0f.js"><link rel="prefetch" href="/assets/js/37.02cdea05.js"><link rel="prefetch" href="/assets/js/38.73f5b560.js"><link rel="prefetch" href="/assets/js/39.68da997f.js"><link rel="prefetch" href="/assets/js/4.e7e80bab.js"><link rel="prefetch" href="/assets/js/40.e7e7dfb3.js"><link rel="prefetch" href="/assets/js/41.8b925a3c.js"><link rel="prefetch" href="/assets/js/42.df73ea87.js"><link rel="prefetch" href="/assets/js/43.e0d2bd59.js"><link rel="prefetch" href="/assets/js/44.6691785a.js"><link rel="prefetch" href="/assets/js/45.eb696a43.js"><link rel="prefetch" href="/assets/js/46.d3eca6a2.js"><link rel="prefetch" href="/assets/js/47.98a8aba0.js"><link rel="prefetch" href="/assets/js/48.6a10d206.js"><link rel="prefetch" href="/assets/js/49.54c8c3b8.js"><link rel="prefetch" href="/assets/js/5.1d5ae844.js"><link rel="prefetch" href="/assets/js/50.bd72c1ad.js"><link rel="prefetch" href="/assets/js/51.a1d48655.js"><link rel="prefetch" href="/assets/js/52.03b1f666.js"><link rel="prefetch" href="/assets/js/53.b120d4a1.js"><link rel="prefetch" href="/assets/js/54.5717b546.js"><link rel="prefetch" href="/assets/js/55.6db45fa6.js"><link rel="prefetch" href="/assets/js/56.fab0e7f4.js"><link rel="prefetch" href="/assets/js/57.d4f35802.js"><link rel="prefetch" href="/assets/js/58.fa4f0e6a.js"><link rel="prefetch" href="/assets/js/59.2be4120a.js"><link rel="prefetch" href="/assets/js/6.29f3ac19.js"><link rel="prefetch" href="/assets/js/60.35982e0a.js"><link rel="prefetch" href="/assets/js/61.913f7316.js"><link rel="prefetch" href="/assets/js/63.f5d235b8.js"><link rel="prefetch" href="/assets/js/64.5e073790.js"><link rel="prefetch" href="/assets/js/65.56a7400b.js"><link rel="prefetch" href="/assets/js/66.14e97e19.js"><link rel="prefetch" href="/assets/js/67.a03d63db.js"><link rel="prefetch" href="/assets/js/68.c515c20f.js"><link rel="prefetch" href="/assets/js/69.14d92b83.js"><link rel="prefetch" href="/assets/js/7.d9e1b9b6.js"><link rel="prefetch" href="/assets/js/70.4f3d78c1.js"><link rel="prefetch" href="/assets/js/71.6de3fdbb.js"><link rel="prefetch" href="/assets/js/72.6c50a271.js"><link rel="prefetch" href="/assets/js/73.6fdc49ca.js"><link rel="prefetch" href="/assets/js/74.aeb43127.js"><link rel="prefetch" href="/assets/js/75.59d70f1a.js"><link rel="prefetch" href="/assets/js/76.1dd1befc.js"><link rel="prefetch" href="/assets/js/77.fba7bae0.js"><link rel="prefetch" href="/assets/js/78.36ab1cc9.js"><link rel="prefetch" href="/assets/js/79.c28e37a2.js"><link rel="prefetch" href="/assets/js/80.2de7dfbf.js"><link rel="prefetch" href="/assets/js/81.250ac215.js"><link rel="prefetch" href="/assets/js/82.04d32fc0.js"><link rel="prefetch" href="/assets/js/83.2ab02d19.js"><link rel="prefetch" href="/assets/js/84.a17a66cd.js"><link rel="prefetch" href="/assets/js/85.a48bd068.js"><link rel="prefetch" href="/assets/js/86.cdb6a513.js"><link rel="prefetch" href="/assets/js/87.d0a5fb29.js"><link rel="prefetch" href="/assets/js/88.31c58de8.js"><link rel="prefetch" href="/assets/js/89.1ac68fc0.js"><link rel="prefetch" href="/assets/js/90.a8d280cb.js"><link rel="prefetch" href="/assets/js/91.0e3c4e3d.js"><link rel="prefetch" href="/assets/js/92.42df38be.js"><link rel="prefetch" href="/assets/js/93.9de0dfe2.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.e9ca0b7c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f3d49e5c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="Cyy's blog" class="logo"> <span class="site-name can-hide">Cyy's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Frontend" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Frontend" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/NodeJs/" class="nav-link">
  NodeJs
</a></li><li class="dropdown-item"><!----> <a href="/Browser/" class="nav-link">
  Browser
</a></li><li class="dropdown-item"><!----> <a href="/TypeScript/" class="nav-link">
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Computer-base" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Computer-base" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NetWork/" class="nav-link router-link-active">
  计算机网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Project-building" class="dropdown-title"><span class="title">项目构建</span> <span class="arrow down"></span></button> <button type="button" aria-label="Project-building" class="mobile-dropdown-title"><span class="title">项目构建</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/Git/" class="nav-link">
  Git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="LeetCode" class="dropdown-title"><span class="title">LeetCode</span> <span class="arrow down"></span></button> <button type="button" aria-label="LeetCode" class="mobile-dropdown-title"><span class="title">LeetCode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/LeetCode/" class="nav-link">
  LeetCode
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Chenyuanyuan299" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Frontend" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Frontend" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/React/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/NodeJs/" class="nav-link">
  NodeJs
</a></li><li class="dropdown-item"><!----> <a href="/Browser/" class="nav-link">
  Browser
</a></li><li class="dropdown-item"><!----> <a href="/TypeScript/" class="nav-link">
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Computer-base" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Computer-base" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NetWork/" class="nav-link router-link-active">
  计算机网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Project-building" class="dropdown-title"><span class="title">项目构建</span> <span class="arrow down"></span></button> <button type="button" aria-label="Project-building" class="mobile-dropdown-title"><span class="title">项目构建</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/Git/" class="nav-link">
  Git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="LeetCode" class="dropdown-title"><span class="title">LeetCode</span> <span class="arrow down"></span></button> <button type="button" aria-label="LeetCode" class="mobile-dropdown-title"><span class="title">LeetCode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/LeetCode/" class="nav-link">
  LeetCode
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Chenyuanyuan299" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>NetWork</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NetWork/networkArch.html" class="sidebar-link">计算机网络体系结构</a></li><li><a href="/NetWork/physicalLayer.html" class="sidebar-link">物理层</a></li><li><a href="/NetWork/dataLinkLayer.html" aria-current="page" class="active sidebar-link">数据链路层</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NetWork/dataLinkLayer.html#主要问题" class="sidebar-link">主要问题</a></li><li class="sidebar-sub-header"><a href="/NetWork/dataLinkLayer.html#ppp-point-to-point-protocol-协议" class="sidebar-link">PPP(Point-to-Point Protocol) 协议</a></li><li class="sidebar-sub-header"><a href="/NetWork/dataLinkLayer.html#以太网历史" class="sidebar-link">以太网历史</a></li><li class="sidebar-sub-header"><a href="/NetWork/dataLinkLayer.html#媒体接入控制" class="sidebar-link">媒体接入控制</a></li><li class="sidebar-sub-header"><a href="/NetWork/dataLinkLayer.html#集线器与交换机" class="sidebar-link">集线器与交换机</a></li><li class="sidebar-sub-header"><a href="/NetWork/dataLinkLayer.html#虚拟局域网-vlan" class="sidebar-link">虚拟局域网 VLAN</a></li></ul></li><li><a href="/NetWork/MAC、IP、ARP.html" class="sidebar-link">MAC 地址、IP 地址以及 ARP 协议</a></li><li><a href="/NetWork/beforeHTTP.html" class="sidebar-link">HTTP 学习准备</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="数据链路层"><a href="#数据链路层" class="header-anchor">#</a> 数据链路层</h1> <p>数据链路层使用的信道主要有以下两种类型：</p> <ol><li><strong>点对点信道</strong>，使用 PPP 协议(Point to Point Protocol)：这种信道使用一对一的点对点通信方式。</li> <li><strong>广播信道</strong>，使用 CSMA/CD 协议(Carrier Sense Multiple Access with Collision Detection)：这种信道使用一对多的广播通信方式，过程比较复杂。</li></ol> <blockquote><p><strong>链路</strong>一般是指一个结点到相邻结点的一段物理线路，而<strong>数据链路</strong>除了必须有物理链路外还需要通信协议来控制数据的传输。也就是说，把实现这些协议的硬件和软件加到链路上就构成了数据链路。最常用的方法是使用<strong>网络适配器</strong>（包含物理层和数据链路层）来实现。</p></blockquote> <h2 id="主要问题"><a href="#主要问题" class="header-anchor">#</a> 主要问题</h2> <p>数据链路层的三个基本问题是：封装成帧、透明传输和差错检测。</p> <h3 id="封装成帧"><a href="#封装成帧" class="header-anchor">#</a> 封装成帧</h3> <p>封装成帧就是在一段数据的前后分别增加首部和尾部，构成一个帧。首部和尾部的作用就是进行帧定界，以及包含一些控制信息。为了提高帧的传输效率，应该使帧的数据部分的长度尽可能长，考虑到差错控制等因素，每一种链路层协议都规定了所能传送的帧的数据部分长度上限——<strong>最大传送单元 MTU</strong>。</p> <p>控制字符 SOH(十六进制01) 放在帧的最前面表示首部开始，ETO(十六进制04) 表示帧的结束，这样接受端就可以通过这两个控制字符判断所接收的帧是否完整。</p> <h3 id="透明传输"><a href="#透明传输" class="header-anchor">#</a> 透明传输</h3> <p>透明传输是指<strong>数据链路层对上层交付的传输数据没有任何限制</strong>，就好像数据链路层不存在一样。</p> <p>由于帧的开始和结束的标记使用专门指明的控制字符，所以传输的数据中不应该出现连续 8bit 的数据和控制字符一样，否则就会造成帧定界的错误。那么应该怎么解决这种问题呢？</p> <ul><li>面向字节的物理链路
使用字节填充的方法实现透明传输：发送端的数据链路层在数据中出现控制字符时，便在前面插入一个<strong>转义字符&quot;ESC&quot;</strong>(十六进制1B)，如果碰到数据中有与转义字符相同的比特，便在前面再插入一个转义字符，这样接受方只要删除所有转义字符就能获取原来的正确数据。</li> <li>面向比特的物理链路
如果数据传输过程中出现连续5个1，使用0比特填充法，在后面插入一个0。</li></ul> <h3 id="差错检测"><a href="#差错检测" class="header-anchor">#</a> 差错检测</h3> <p>实际的通信链路都不是理想的，比特在传输过程中可能会产生差错，1变0或0变1，这称为比特差错。在一段时间内，传输错误的比特占所传输比特总数的比率称为<strong>误码率 BER</strong>。</p> <p>目前在数据链路层广泛使用的是<strong>循环冗余检验 CRC(Cycle Redundancy Cheek)</strong>。</p> <ul><li>收发双方约定好一个生成多项式；</li> <li>发送方基于待发送数据和生成多项式计算出差错检测码（冗余码），并添加到代传输数据后面；</li> <li>接受方通过生成多项式来计算收到的数据是否产生了误码。</li></ul> <img src="/NetWork/generator.png" alt="generator"> <img src="/NetWork/demo01.png" alt="demo"> <p>这种为了进行检错而添加的冗余码常称为<strong>帧检验序列FCS</strong>。</p> <h3 id="可靠传输"><a href="#可靠传输" class="header-anchor">#</a> 可靠传输</h3> <p>上述的所有过程中，并没有要求数据链路层向网络层提供“<strong>可靠传输</strong>”服务。</p> <p>所谓可靠传输，通俗的讲就是：数据链路层的发送端发送什么，接收端就接收到什么。比特差错只是传输差错中的一种，<strong>从整个计网体系来看</strong>，传输差错还包括<strong>分组丢失、分组重复或分组失序</strong>（一般出现在上层）。</p> <p>一般情况下，<strong>有线链路</strong>的误码率比较低，不要求可靠传输，那么出错的帧丢弃就算了，数据链路层不用做任何处理，可靠传输问题由上层解决。</p> <p><strong>无线链路</strong>易受干扰，误码率较高，因此要求数据链路层必须提供可靠传输服务，那么就得想办法解决这种问题。</p> <p>PS，从上到下：</p> <ul><li>TCP 向上提供面向连接、可靠；UDP 无连接、不可靠。</li> <li>IP 向上提供无连接、不可靠；</li> <li>802.11无线局域网要求数据链路层提供可靠传输；以太网不要求提供可靠传输。</li></ul> <h2 id="ppp-point-to-point-protocol-协议"><a href="#ppp-point-to-point-protocol-协议" class="header-anchor">#</a> PPP(Point-to-Point Protocol) 协议</h2> <p>在通信链路较差的年代，数据链路层使用可靠传输是不错的办法，HDLC 协议(High-level Data Link Control，高级数据链路控) 是当时选择的可靠传输协议。随着通信链路质量的提升，PPP 协议逐渐取代了 HDLC。</p> <p>PPP 协议就是用户计算机和 ISP 进行通信时所使用的数据链路层协议。PPP 协议应该满足一些需求，1999年公布的 PPPoE 是一个典型的例子，它使得 ISP 可以通过 DSL、电路调制解调器、以太网等宽带接入技术，以以太网接口的形式为用户提供接入服务。</p> <p>PPP 协议为在点对点链路传输各种协议数据报提供了一个标准方法，主要由以下三部分构成：</p> <ul><li>对各种协议数据报的封装方法（封装成帧）；</li> <li>链路控制协议 LCP，用于建立、配置以及测试数据链路的连接；</li> <li>一套网络控制协议 NCPs，其中的每一个协议支持不同的网络层协议。</li></ul> <p>这些方法让 PPP 协议能够在多种类型的点对点链路上运行，比如面向字节的异步链路和面向比特的同步链路。</p> <p>以下是 PPP 协议的帧格式：</p> <img src="/NetWork/PPP.png" alt="PPP"> <h3 id="透明传输-2"><a href="#透明传输-2" class="header-anchor">#</a> 透明传输</h3> <img src="/NetWork/PPP透明传输01.png" alt="PPP透明传输面向字节"> <img src="/NetWork/PPP透明传输02.png" alt="PPP透明传输面向比特"> <h3 id="差错检测-2"><a href="#差错检测-2" class="header-anchor">#</a> 差错检测</h3> <p>PPP 协议规定：接收方每收到一个 PPP 帧，就进行 CRC 检验。若 CRC 检验正确，就收下这个帧；反之则丢弃。PPP 协议并不需要向上层提供可靠传输服务。</p> <h3 id="工作状态"><a href="#工作状态" class="header-anchor">#</a> 工作状态</h3> <p>PPP 链路的初始化：</p> <p>当用户拨号接入 ISP 后，就建立了一条从用户个人电脑到 ISP 的物理连接。这时，用户个人电脑向 ISP 发送一系列的链路控制协议 LCP 分组（封装成多个 PPP 帧)，以便建立 LCP 连接。这些分组及其响应选择了将要使用的一些 PPP 参数。接着还要进行网络层配置，网络控制协议 NCP 给新接入的用户个人电脑分配一个临时的 IP 地址。这样用户个人电脑就成为互联网上的一个有 IP 地址的主机了。</p> <p>当用户通信完毕时，NCP 释放网络层连接，收回原来分配出去的 IP 地址。接着，LCP 释放数据链路层连接。最后释放的是物理层的连接。</p> <img src="/NetWork/PPP协议的工作状态.png" alt="PPP协议的工作状态"> <h2 id="以太网历史"><a href="#以太网历史" class="header-anchor">#</a> 以太网历史</h2> <p>局域网按照拓扑结构分为星形网、环形网和总线网，总线网以以太网最为出名。IEEE802委员会提出了802.3局域网标准（严格说与具体的以太网标准有一丝差别）。</p> <p>后来又出现了几个不同的局域网标准，为了使数据链路层更好地适应多种局域网标准，802委员会就把局域网的数据链路层分为了两个子层，分别是<strong>逻辑链路控制 LLC <strong>和</strong>媒体接入控制 MAC</strong>(Medium Access Control)。</p> <p>再后来，由于 TCP/IP 体系经常使用以太网原来的标准 DIX Ethernet V2，LLC 的作用已经消失了，只剩下 MAC。</p> <h3 id="适配器"><a href="#适配器" class="header-anchor">#</a> 适配器</h3> <p>计算机与外界局域网的连接是通过通信适配器进行的。原来的适配器是外接的网络接口卡 NIC，现在的计算机主板基本使用内部嵌入适配器。适配器上装有处理器和存储器（包括 RAM 和 ROM）。</p> <p>适配器与局域网之间的通信是通过电缆或者双绞线的串行传输，与电脑之间是通过主板上的 I/O 总线并行传输，所以适配器的一个重要功能就是进行数据转换。由于网络上的数据率和计算机上的不一样，所以适配器需要存储芯片来缓存数据。同时计算机的操作系统应该装有管理适配器的设备驱动程序。适配器还要能够实现以太网协议。（此处的适配器使用有线传输，现代笔记本大多自带无线网卡）。</p> <p>适配器在接受发送数据过程中不使用 CPU，当收到有差错的帧自行丢弃而不必告诉计算机，当收到正确的帧就通过中断来通知计算机，并把数据交付给网络层。当计算机要发送 IP 数据报，则通过协议栈把数据向下交给适配器，由适配器封装成帧后发送到局域网。（现在的芯片集成度很高，适配器一般包含数据链路层和物理层）。</p> <blockquote><p>计算机的硬件地址就在适配器的 ROM 中，计算机的软件地址（IP 地址）则在计算机的存储器中。</p></blockquote> <h2 id="媒体接入控制"><a href="#媒体接入控制" class="header-anchor">#</a> 媒体接入控制</h2> <p>共享信道要着重考虑的一个问题就是如何协同多个发送和接收站点对一个共享传输媒体的占用，即<strong>媒体接入控制 MAC</strong>(Medium Access Control)。</p> <p>有两种解决的办法：</p> <ul><li>静态划分信道：频分复用 FDM、时分复用 TDM、波分复用 WDM 和码分复用 CDM。</li> <li>动态接入控制：随机接入、受控接入（已淘汰）</li></ul> <h3 id="随机接入主要使用以下两种协议"><a href="#随机接入主要使用以下两种协议" class="header-anchor">#</a> 随机接入主要使用以下两种协议：</h3> <h3 id="csma-cd-协议"><a href="#csma-cd-协议" class="header-anchor">#</a> CSMA/CD 协议</h3> <p>CSMA/CD 协议主要用于总线局域网。</p> <img src="/NetWork/CSMA-CD.png" alt="CSMA-CD"> <p>对于该协议来说，有三个要点，第一是<strong>争用期</strong>，以太网的端到端往返传播时延称为争用期，主机最多经过一个争用期可以检测到是否发生碰撞，因此共享式以太网不能连接太多的主机，使用的总线也不能太长；</p> <p>第二个要点是<strong>最小和最大帧长</strong>，范围是64字节~1518字节（以太网V2的MAC帧，802.1Q帧为1522字节），以太网的最小帧长确保了主机可以在帧发送完成之前就检测到该帧的发送过程是否遭遇了碰撞；最大帧长确保总线不会被一台主机长时间占用；</p> <p>第三个要点是<strong>截断二进制指数退避算法</strong>，这个算法可以确定碰撞后重传的时机。</p> <img src="/NetWork/帧发送流程.png" alt="帧发送流程"> <img src="/NetWork/帧接收流程.png" alt="帧接收流程"> <h3 id="csma-ca-协议"><a href="#csma-ca-协议" class="header-anchor">#</a> CSMA/CA 协议</h3> <p>CSMA/CA 协议主要用于无线局域网。802.11无线局域网在 CSMA 的基础上增加了<strong>碰撞避免 CA</strong> 功能，不再使用碰撞检测，同时，由于不可避免所有碰撞，并且无线信道误码率较高，802.11标准还使用了数据链路层的停止-等待协议来确保数据正确接收。</p> <p>802.11的 MAC 层标准定义了两种不同的媒体接入控制方式：</p> <ul><li>分布式协调功能 DCF：没有中心控制站点，每个站点使用 CSMA/CA 协议通过争用信道来获取发送权。</li> <li>点协调功能 PCF：使用集中控制的接入算法，较少使用。</li></ul> <p>802.11标准规定，所有的站点<strong>必须在持续检测到信道空闲一段指定时间后才能发送帧</strong>，这段时间称为<strong>帧间间隔IFS</strong>。</p> <p>帧间间隔的长短取决于该站点要发送的帧的类型:</p> <ul><li>高优先级帧需要等待的时间较短，因此可优先获得发送权;</li> <li>低优先级帧需要等待的时间较长。若某个站的低优先级帧还没来得及发送，而其他站的高优先级帧已发送到信道上，则信道变为忙态，因而低优先级帧就只能再推迟发送了。这样就减少了发生碰撞的机会。</li></ul> <p>常用的两种帧间间隔如下:</p> <ul><li>短帧间间隔 SIFS(28us)，是最短的帧间间隔，用来分隔开属于一次对话的各帧。一个站点应当能够在这段时间内从发送方式切换到接收方式。使用SIFS的帧类型有 ACK 帧、CTS 帧、由过长的 MAC 帧分片后的数据帧、以及所有回答 AP 探询的帧和在 PCF 方式中接入点 AP 发送出的任何帧。</li> <li>DCF帧间间隔 DIFS(128us)，它比短帧间间隔 SIFS 要长得多，在 DCF 方式中用来发送数据帧和管理帧。</li></ul> <p><strong>CSMA/CA 协议的工作原理</strong>：</p> <img src="/NetWork/CSMA-CD工作原理.png" alt="CSMA-CD工作原理"> <p>其中，退避算法如下所示：</p> <img src="/NetWork/退避算法.png" alt="退避算法"> <p><strong>信道预约：</strong></p> <p>为了<strong>尽可能减少碰撞的概率</strong>和降低碰撞的影响，802.11标准允许要发送数据的站点<strong>对信道进行预约</strong>。</p> <ol><li>源站在发送数据帧之前先发送一个短的控制帧，称为<strong>请求发送 RTS</strong>(Request To Send)，它包括源地址、目的地址以及这次通信（包括相应的确认帧）所需的持续时间。</li> <li>若目的站正确收到源站发来的 RTS 帧，且媒体空闲，就发送一个响应控制帧，称为<strong>允许发送 CTS</strong>(Cear To Send)，它也包括这次通信所需的
持续时间（从 RTS 帧中将此持续时间复制到 CTS 帧中）。</li> <li>源站收到 CTS 帧后，再等待一段时间 SIFS 后，就可发送其数据帧。</li> <li>若目的站正确收到了源站发来的数据帧，在等待时间 SIFS 后，就向源站发送确认帧 ACK。</li></ol> <p>除源站和目的站以外的其他各站，在收到 CTS 帧（或数据帧）后就<strong>推迟接入</strong>到无线局域网中，这样就保证了源站和目的站之间的通信不会受到其他站的干扰。</p> <p>如果 RTS 帧发生碰撞，源站就收不到 CTS 帧，需执行退避算法重传 RTS 帧。</p> <p>由于 RTS 帧和 CTS 帧很短，发送碰撞的概率、碰撞产生的开销及本身的开销都很小。而对于一般的数据帧，其发送时延往往大于传播时延（因为是局域网)，碰撞的概率很大，且一旦发生碰撞而导致数据帧重发，则浪费的时间就很多，因此用很小的代价对信道进行预约往往是值得的。802.11标准规定了3种情况供用户选择:</p> <ul><li>使用 RTS 帧和 CTS 帧</li> <li>不使用 RTS 帧和 CTS 帧</li> <li>只有当数据帧的长度超过某一数值时才使用 RTS 帧和 CTS 帧</li></ul> <img src="/NetWork/信道预约.png" alt="信道预约"> <p><strong>虚拟载波监听：</strong></p> <p>除 RTS 帧和 CTS 帧会携带通信需要持续的时间，数据帧也能携带通信需要持续的时间，这称为802.11的<strong>虚拟载波监听机制</strong>。由于利用虚拟载波监听机制，站点只要监听到 RTS 帧、CTS 帧或数据帧中的任何一个，就能知道信道被占用的持续时间，而不需要真正监听到信道上的信号，因此虚拟载波监听机制能减少隐蔽站带来的碰撞问题。</p> <img src="/NetWork/虚拟载波监听.png" alt="虚拟载波监听"> <h2 id="集线器与交换机"><a href="#集线器与交换机" class="header-anchor">#</a> 集线器与交换机</h2> <p>早期的总线型以太网使用同轴电缆作为媒介，淘汰后，使用双绞线和集线器 HUB 的星型以太网，然后又被淘汰了，使用交换机。</p> <ul><li>集线器在逻辑上，仍然是总线网，使用 CSMA/CD 协议（半双工）；</li> <li>集线器只工作在物理层，不进行碰撞检测（由各站网卡负责，网卡会检测 MAC 地址）；</li> <li>集线器一般都有少量的容错能力和网络管理功能。</li></ul> <p>以太网交换机则更先进，在交换机的帧交换表完整的情况下：</p> <ul><li>工作在全双工方式下；</li> <li>具有并行性，能同时连通多个接口，无碰撞；</li> <li>以太网交换机工作在数据链路层（以及物理层），它收到帧后，会在帧交换表中查找帧的目的 MAC 地址所对应的接口号，然后通过该接口转发，这样可以隔离碰撞域；</li> <li>以太网交换机具有多种速率的接口，每个接口是一个独立的碰撞域；</li> <li>以太网交换机的帧交换表是通过自学习算法建立的，具有即插即用性；</li> <li>以太网交换机同样具有集线器的广播特性。</li></ul> <p>以太网交换机具有自学习算法，一开始会通过各主机的交互建立起帧交换表（默认各主机已经通过 ARP 协议知道目的主机的 MAC 地址），帧交换表中的数据会定期删除，这是为了防止对应接口的主机 MAC 地址发生改变。</p> <h3 id="交换机的生成树协议-stp"><a href="#交换机的生成树协议-stp" class="header-anchor">#</a> 交换机的生成树协议 STP</h3> <p>以太网为了保证可靠性，一般会增加冗余链路，但是这会形成网络环路造成广播风暴，于是就有了生成树协议。</p> <p>以下是生成树算法的简要作用：</p> <ul><li>不论交换机之间采用怎样的物理连接，交换机都能够<strong>自动计算并构建一个逻辑上没有环路的网络</strong>，其逻辑拓扑结构必须是树型的（无逻辑环路）；</li> <li>最终生成的树型逻辑拓扑要<strong>确保连通整个网络</strong>；</li> <li>当首次连接交换机或网络<strong>物理拓扑发生变化</strong>时（有可能是人为改变或故障)，交换机都将进行<strong>生成树的重新计算</strong>。</li></ul> <h2 id="虚拟局域网-vlan"><a href="#虚拟局域网-vlan" class="header-anchor">#</a> 虚拟局域网 VLAN</h2> <p>随着使用交换机不断地扩大网络，同时形成了更大的广播域，这样不仅更容易造成广播风暴，同时在发送数据的过程中也可能会占据太多网络资源（ARP 查 MAC 地址），路由器虽然可以分割广播域，但是成本较高，于是虚拟局域网 VLAN 应运而生。</p> <p>虚拟局域网 VLAN 是一种将局域网内的设备<strong>划分成与物理位置无关的逻辑组的技术</strong>，这些逻辑组具有某些共同的需求。</p> <h3 id="实现机制"><a href="#实现机制" class="header-anchor">#</a> 实现机制</h3> <p>IEEE 802.1Q 帧，对以太网的 MAC 帧格式进行了拓展，插入了4字节的 VLAN 标记。VLAN 标记的最后12比特称为 VLAN 标识符 VID，它唯一地标志了以太网帧属于哪一个 VLAN，取值范围1~4094。</p> <p>802.1Q 帧是由交换机来处理，交换机收到普通的以太网帧时，会为其打上 VLAN 的标记，转发时去掉。交换机的端口类型有：Access、Trunk 和 Hybrid。在华为交换机上，交换机各端口的缺省 VLAN ID 称为 Port VLAN ID，简记 PVID。</p> <p>Access 端口的处理：</p> <img src="/NetWork/Access.png" alt="Access"> <p>Trunk 端口的处理：</p> <img src="/NetWork/Trunk.png" alt="Trunk"> <p>Hybrid 端口的处理：</p> <img src="/NetWork/Hybrid.png" alt="Hybrid"></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/22/2024, 6:23:50 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/NetWork/physicalLayer.html" class="prev">
        物理层
      </a></span> <span class="next"><a href="/NetWork/MAC、IP、ARP.html">
        MAC 地址、IP 地址以及 ARP 协议
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.af7ffc51.js" defer></script><script src="/assets/js/2.d1a5c91e.js" defer></script><script src="/assets/js/1.8e8fa9b9.js" defer></script><script src="/assets/js/62.ae031adb.js" defer></script>
  </body>
</html>
